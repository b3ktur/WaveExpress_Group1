{% extends 'base.html' %}

{% block title %}My Reservations - WaveExpress{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">My Reservations</h1>
    
    {% if reservations %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Reservation #</th>
                        <th>Route</th>
                        <th>Departure</th>
                        <th>Status</th>
                        <th>Date Reserved</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reservation in reservations %}
                    <tr>
                        <td>{{ reservation.reservation_id }}</td>
                        <td>{{ reservation.schedule.route.route_name }}</td>
                        <td>
                            <strong>{{ reservation.schedule.departure_time|date:"D, M d, Y" }}</strong><br>
                            {{ reservation.schedule.departure_time|time:"h:i A" }}<br>
                            <small>{{ reservation.schedule.route.departure_port.port_name }}</small>
                        </td>
                        <td>
                            <span class="badge {% if reservation.status == 'CONFIRMED' %}bg-success{% elif reservation.status == 'PENDING' %}bg-warning{% elif reservation.status == 'COMPLETED' %}bg-info{% else %}bg-danger{% endif %}">
                                {{ reservation.status }}
                            </span>
                        </td>
                        <td>{{ reservation.date_of_reservation|date:"M d, Y" }}</td>
                        <td>
                            <div class="btn-group-vertical" role="group">
                                <a href="{% url 'ferry_system:reservation_detail' reservation.reservation_id %}" class="btn btn-primary btn-sm">
                                    View Details
                                </a>
                                
                                {% if reservation.status == 'CONFIRMED' and reservation.schedule.departure_time > now %}
                                    <a href="{% url 'ferry_system:convert_to_ticket' reservation.reservation_id %}" class="btn btn-success btn-sm">
                                        Convert to Ticket
                                    </a>
                                    
                                    {% if reservation.schedule.departure_time|timeuntil:now|split:" "|length > 1 %}
                                        {% if reservation.schedule.departure_time|timeuntil:now|split:" "|0 >= "2" and reservation.schedule.departure_time|timeuntil:now|split:" "|1 == "days" %}
                                            <a href="{% url 'ferry_system:cancel_reservation' reservation.reservation_id %}" class="btn btn-danger btn-sm">
                                                Cancel
                                            </a>
                                        {% endif %}
                                    {% endif %}
                                {% elif reservation.status == 'PENDING' %}
                                    <a href="{% url 'ferry_system:pay_reservation' reservation.reservation_id %}" class="btn btn-warning btn-sm">
                                        Pay Deposit
                                    </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info">
            <h4 class="alert-heading">No Reservations Found</h4>
            <p>You don't have any reservations yet. Why not check out the available schedules?</p>
            <hr>
            <a href="{% url 'ferry_system:schedule_list' %}" class="btn btn-primary">Browse Schedules</a>
        </div>
    {% endif %}
    
    <div class="mt-4">
        <a href="{% url 'ferry_system:schedule_list' %}" class="btn btn-primary">
            <i class="bi bi-calendar"></i> Browse Schedules
        </a>
        <a href="{% url 'ferry_system:my_tickets' %}" class="btn btn-secondary">
            <i class="bi bi-ticket"></i> My Tickets
        </a>
    </div>
</div>
{% endblock %}
